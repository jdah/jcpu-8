

#ORG 0X0000



#OS_CALLS:
LDA 0X00 0XB4
JNZ 0X01
LDA 0X01 0X4D
JNZ 0X01
LDA 0X00 0XF0
JNZ 0X01
LDA 0X01 0X08
JNZ 0X01
LDA 0X01 0X20
JNZ 0X01
LDA 0X01 0X38
JNZ 0X01
LDA 0X00 0XD8
JNZ 0X01
LDA 0X01 0X8F
JNZ 0X01
LDA 0X01 0XA7
JNZ 0X01
LDA 0X01 0XC2
JNZ 0X01
LDA 0X01 0XD7
JNZ 0X01
LDA 0X02 0X04
JNZ 0X01
LDA 0X02 0X31
JNZ 0X01
LDA 0X02 0X46
JNZ 0X01
LDA 0X02 0X61
JNZ 0X01
LDA 0X02 0X7C
JNZ 0X01
LDA 0X02 0X97
JNZ 0X01
LDA 0X02 0XB2
JNZ 0X01
LDA 0X02 0XCD
JNZ 0X01
LDA 0X02 0XE8
JNZ 0X01
LDA 0X03 0X03
JNZ 0X01
LDA 0X03 0X18
JNZ 0X01
LDA 0X03 0X30
JNZ 0X01
LDA 0X03 0X45
JNZ 0X01
LDA 0X03 0X60
JNZ 0X01

LDA 0X05 0X8B
JNZ 0X01
LDA 0X05 0XC0
JNZ 0X01
LDA 0X06 0X0E
JNZ 0X01
LDA 0X06 0X5C
JNZ 0X01
LDA 0X06 0X88
JNZ 0X01
LDA 0X06 0XB4
JNZ 0X01
LDA 0X06 0XC0
JNZ 0X01
LDA 0X07 0X1F
JNZ 0X01
LDA 0X07 0X8B
JNZ 0X01
LDA 0X08 0X16
JNZ 0X01

LDA 0X03 0XAB
JNZ 0X01

#BOOT_MAIN:
LDA 0XFF 0X09
SW 0X81
LDA 0XFF 0X08
SW 0XFF

LC A 0X02
LC B 0XEF
LC C 0X00
LC D 0X06
PUSH 0X00
PUSH 0XD3
LDA 0X07 0X1F
JNZ 0X01

LDA 0X00 0XD3
JNZ 0X01

#DB TESTSTRING "Hello, emulator world!"




#INCLUDE "modules/rpi.asm"





#RPI_DRAW_SPRITE:
LC F 0X20
SWA F 0XFF 0X01
SWA A 0XFF 0X02

PUSH 0X00
PUSH 0XEA
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_GEN_SPRITE:
LC F 0X01
SWA F 0XFF 0X01

PUSH 0X00
PUSH 0XFF
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07

POP L
POP H
JNZ 0X01




#RPI_DEL_SPRITE:
LC F 0X02
SWA F 0XFF 0X01
SWA A 0XFF 0X02

PUSH 0X01
PUSH 0X1A
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_BEGIN_BUILD_SPRITE:
LC F 0X03
SWA F 0XFF 0X01
SWA A 0XFF 0X02

PUSH 0X01
PUSH 0X32
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_STOP_BUILD_SPRITE:
LC F 0X04
SWA F 0XFF 0X01

PUSH 0X01
PUSH 0X47
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_UPLOAD_PIXEL:
LC F 0X05
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X01
PUSH 0X62
LDA 0X03 0X7B
JNZ 0X01

LC F 0X06
SWA F 0XFF 0X01
SWA C 0XFF 0X02
SWA D 0XFF 0X03
PUSH 0X01
PUSH 0X77
LDA 0X03 0X7B
JNZ 0X01

LC F 0X07
SWA F 0XFF 0X01
SWA E 0XFF 0X02
PUSH 0X01
PUSH 0X89
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_KEYBOARD_HAS_NEXT:
LC F 0X08
SWA F 0XFF 0X01
PUSH 0X01
PUSH 0X9E
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07

POP L
POP H
JNZ 0X01




#RPI_KEYBOARD_NEXT:
LC F 0X09
SWA F 0XFF 0X01
PUSH 0X01
PUSH 0XB6
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07
LWA B 0XFF 0X08

POP L
POP H
JNZ 0X01




#RPI_KEYBOARD_CLEAR_BUFFER:
LC F 0X0A
SWA F 0XFF 0X01
PUSH 0X01
PUSH 0XD1
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_TRANSLATE_X:
LC F 0X0E
SWA F 0XFF 0X01
SWA A 0XFF 0X02
PUSH 0X01
PUSH 0XE9
LDA 0X03 0X7B
JNZ 0X01

LC F 0X0B
SWA F 0XFF 0X01
SWA B 0XFF 0X02
SWA C 0XFF 0X03
PUSH 0X01
PUSH 0XFE
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_TRANSLATE_Y:
LC F 0X0E
SWA F 0XFF 0X01
SWA A 0XFF 0X02
PUSH 0X02
PUSH 0X16
LDA 0X03 0X7B
JNZ 0X01

LC F 0X0C
SWA F 0XFF 0X01
SWA B 0XFF 0X02
SWA C 0XFF 0X03
PUSH 0X02
PUSH 0X2B
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_TRANSLATE_RESET:
LC F 0X0D
SWA F 0XFF 0X01
PUSH 0X02
PUSH 0X40
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_STORAGE_ADDR_HIGH:
LC F 0X0F
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X02
PUSH 0X5B
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_STORAGE_ADDR_LOW:
LC F 0X10
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X02
PUSH 0X76
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_STORAGE_READ:
LC F 0X11
SWA F 0XFF 0X01
PUSH 0X02
PUSH 0X8B
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07
LWA B 0XFF 0X08

POP L
POP H
JNZ 0X01




#RPI_STORAGE_WRITE:
LC F 0X12
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X02
PUSH 0XAC
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_STORAGE_SIZE_MB:
LC F 0X13
SWA F 0XFF 0X01
PUSH 0X02
PUSH 0XC1
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07
LWA B 0XFF 0X08

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_WIDTH:
LC F 0X17
SWA F 0XFF 0X01
PUSH 0X02
PUSH 0XDC
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07
LWA B 0XFF 0X08

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_HEIGHT:
LC F 0X18
SWA F 0XFF 0X01
PUSH 0X02
PUSH 0XF7
LDA 0X03 0X7B
JNZ 0X01

LWA A 0XFF 0X07
LWA B 0XFF 0X08

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_CLEAR:
LC F 0X19
SWA F 0XFF 0X01
PUSH 0X03
PUSH 0X12
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_COLOR:
LC F 0X21
SWA F 0XFF 0X01
SWA A 0XFF 0X02
PUSH 0X03
PUSH 0X2A
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_END_COLOR:
LC F 0X22
SWA F 0XFF 0X01
PUSH 0X03
PUSH 0X3F
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_MOVE_X:
LC F 0X23
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X03
PUSH 0X5A
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#RPI_GRAPHICS_MOVE_Y:
LC F 0X24
SWA F 0XFF 0X01
SWA A 0XFF 0X02
SWA B 0XFF 0X03
PUSH 0X03
PUSH 0X75
LDA 0X03 0X7B
JNZ 0X01

POP L
POP H
JNZ 0X01




#WAIT_FOR_RESPONSE:
PUSH A
LWA A 0X08 0X74
ADD A 0X01
SWA A 0X08 0X74
SWA A 0XFF 0X00

PUSH B
LWA B 0XFF 0X06
LDF B A
AND F 0X04
MW F B
LDA 0X03 0XA1
JNZ B
LDA 0X03 0X7B
JNZ 0X01

#WAIT_FOR_RESPONSE__DONE:
POP B
POP A
POP L
POP H
JNZ 0X01

#DB NEXTRESPONSE 0X00
#INCLUDE "modules/graphics.asm"



#DEFINE GRAPHICS_CURSOR_CHARACTER 0X5F




#GRAPHICS_PRINT_STR:
PUSH C
PUSH D
PUSH E
PUSH A
PUSH B


LC A 0X00
LC B 0X00
LWA C 0X08 0X75
PUSH 0X03
PUSH 0XC7
LDA 0X01 0XD7
JNZ 0X01

LWA C 0X08 0X76
PUSH 0X03
PUSH 0XD3
LDA 0X02 0X04
JNZ 0X01

LDA 0X03 0XD8
JNZ 0X01

#GRAPHICS_PRINT_STR__LOOP:
MW A H
MW B L
LW E

MW E C
LDF C 0X00
AND F 0X04
MW F C
LDA 0X04 0X25
JNZ C


PUSH A
PUSH B


MW E A
PUSH 0X04
PUSH 0X01
LDA 0X00 0XD8
JNZ 0X01


LC A 0X00
LC B 0X00
LC C 0X08
PUSH 0X04
PUSH 0X13
LDA 0X01 0XD7
JNZ 0X01

POP B
POP A


PUSH 0X04
PUSH 0X20
LDA 0X06 0X5C
JNZ 0X01
LDA 0X03 0XD8
JNZ 0X01

#GRAPHICS_PRINT_STR__DONE:
PUSH 0X04
PUSH 0X2E
LDA 0X02 0X31
JNZ 0X01

POP B
POP A
POP E
POP D
POP C
POP L
POP H
JNZ 0X01


#GRAPHICS_INIT:
PUSH C
PUSH D


PUSH 0X04
PUSH 0X4B
LDA 0X02 0XCD
JNZ 0X01
LC C 0X00
LC D 0X08
PUSH 0X04
PUSH 0X5A
LDA 0X07 0X8B
JNZ 0X01
SWA B 0X08 0X77

PUSH 0X04
PUSH 0X66
LDA 0X02 0XE8
JNZ 0X01
PUSH 0X04
PUSH 0X6F
LDA 0X07 0X8B
JNZ 0X01
SWA B 0X08 0X78

POP C
POP D
POP L
POP H
JNZ 0X01




#GRAPHICS_DRAW_CHAR:
PUSH A
PUSH B
PUSH C
PUSH D


PUSH B
MW A B
LC A 0X00
LC C 0X00
LC D 0X08
PUSH 0X04
PUSH 0X9B
LDA 0X07 0X1F
JNZ 0X01

MW B C
MW A B
LC A 0X00
PUSH 0X04
PUSH 0XAD
LDA 0X01 0XD7
JNZ 0X01
POP B


LC A 0X00
LC C 0X00
LC D 0X08
PUSH 0X04
PUSH 0XC1
LDA 0X07 0X1F
JNZ 0X01

MW B C
MW A B
LC A 0X00
PUSH 0X04
PUSH 0XD3
LDA 0X02 0X04
JNZ 0X01

POP D
POP C
POP B
POP A


PUSH A
MW C A
PUSH 0X04
PUSH 0XE9
LDA 0X00 0XD8
JNZ 0X01
POP A


PUSH 0X04
PUSH 0XF4
LDA 0X02 0X31
JNZ 0X01

POP L
POP H
JNZ 0X01




#GRAPHICS_SCROLL:
PUSH A
PUSH B


LC A 0X01
LC B 0X08
PUSH 0X05
PUSH 0X0D
LDA 0X03 0X45
JNZ 0X01


LWA A 0X08 0X78
ADD A 0XFF
SWA A 0X08 0X76


LC A 0X00
SWA A 0X08 0X75

POP B
POP A
POP L
POP H
JNZ 0X01




#GRAPHICS_INC_CURSOR:
PUSH B
PUSH C


LWA B 0X08 0X75
LWA C 0X08 0X77
ADD B 0X01
SWA B 0X08 0X75


LDF B C
AND F 0X04
MW F B
LDA 0X05 0X4E
JNZ B

POP C
POP B
POP L
POP H
JNZ 0X01

#GRAPHICS_INC_CURSOR__INC_Y:
LC B 0X00
SWA B 0X08 0X75


LWA B 0X08 0X76
LWA C 0X08 0X78
ADD B 0X01
SWA B 0X08 0X76


LDF B C
AND F 0X04
MW F B
LDA 0X05 0X78
JNZ B

POP C
POP B
POP L
POP H
JNZ 0X01

#GRAPHICS_INC_CURSOR__SCROLL:
PUSH 0X05
PUSH 0X81
LDA 0X04 0XFA
JNZ 0X01
POP C
POP B
POP L
POP H
JNZ 0X01


#DB CURSORX 0X00
#DB CURSORY 0X00


#DB WIDTHCHARS 0X00
#DB HEIGHTCHARS 0X00
#INCLUDE "modules/math.asm"









#INT_16_EQU:
PUSH C
PUSH D

LC E 0X00

LDF C A
AND F 0X04
MW F C
LDA 0X05 0XAA
JNZ C

POP D
POP C
POP L
POP H
JNZ 0X01

#INT_16_EQU__CHECK_LOW:
LDF D B
AND F 0X04
MW F D
MW D E

POP D
POP C
POP L
POP H
JNZ 0X01




#INT_16_GTN:
MW A E
LDF E C
AND F 0X02
MW F E
LDA 0X05 0XFC
JNZ E

MW A E
LDF E C
AND F 0X08
MW F E
LDA 0X06 0X05
JNZ E


MW B E
LDF E D
AND F 0X02
MW F E
LDA 0X05 0XFC
JNZ E


LC E 0X00
POP L
POP H
JNZ 0X01

#INT_16_GTN__TRUE:
LC E 0X01
POP L
POP H
JNZ 0X01

#INT_16_GTN__FALSE:
LC E 0X00
POP L
POP H
JNZ 0X01




#INT_16_LTN:
MW A E
LDF E C
AND F 0X02
MW F E
LDA 0X06 0X05
JNZ E

MW A E
LDF A C
AND F 0X04
MW F A
LDA 0X05 0XFC
JNZ E


MW B E
LDF E D
AND F 0X08
MW F E
LDA 0X05 0XFC
JNZ E


LC E 0X00
POP L
POP H
JNZ 0X01

#INT_16_LTN__TRUE:
LC E 0X01
POP L
POP H
JNZ 0X01

#INT_16_LTN__FALSE:
LC E 0X00
POP L
POP H
JNZ 0X01




#INT_16_INC:
PUSH C

MW B C
LDF C 0XFF
AND F 0X04
MW F C
LDA 0X06 0X7A
JNZ F

ADD B 0X01

POP C
POP L
POP H
JNZ 0X01

#INT_16_INC__LOW_MAX:
LC B 0X00
ADD A 0X01

POP C
POP L
POP H
JNZ 0X01




#INT_16_DEC:
PUSH C

MW B C
LDF C 0X00
AND F 0X04
MW F C
LDA 0X06 0XA6
JNZ F

ADD B 0XFF

POP C
POP L
POP H
JNZ 0X01

#INT_16_DEC__LOW_MIN:
LC B 0XFF
ADD A 0XFF

POP C
POP L
POP H
JNZ 0X01




#INT_16_ADD:
ADD B D
ADC A C

POP L
POP H
JNZ 0X01




#INT_16_SUB:
PUSH E

MW D E
LDF E B
AND F 0X02
MW F E
LDA 0X06 0XF3
JNZ E

MW D H
NOR H H
ADD H 0X01
ADD B H
MW C H
NOR H H
ADD H 0X01
ADD A H

POP E
POP L
POP H
JNZ 0X01


#INT_16_SUB__BORROW:

LC E 0XFF
MW D H
NOR H H
ADD H 0X01
ADD E H
ADD B E
ADD B 0X01

MW C H
NOR H H
ADD H 0X01
ADD A H
ADD A 0XFF

POP E
POP L
POP H
JNZ 0X01




#INT_16_MUL:

PUSH C
PUSH D
PUSH E

LDA 0X07 0X2A
JNZ 0X01

#INT_16_MUL__LOOP:

PUSH A
PUSH B
LC A 0X00
LC B 0X00
PUSH 0X07
PUSH 0X3D
LDA 0X05 0X8B
JNZ 0X01
POP B
POP A

LDA 0X07 0X7F
JNZ E

PUSH C
PUSH D

MW A C
MW B D
PUSH 0X07
PUSH 0X59
LDA 0X06 0XB4
JNZ 0X01

POP D
POP C

PUSH A
PUSH B

MW C A
MW D B
PUSH 0X07
PUSH 0X70
LDA 0X06 0X88
JNZ 0X01
MW A C
MW B D

POP B
POP A

LDA 0X07 0X2A
JNZ 0X01

#INT_16_MUL__DONE:
POP E
POP D
POP C
POP L
POP H
JNZ 0X01




#INT_16_DIV:
PUSH E


LDA 0X08 0X79
SW 0X00

LDA 0X08 0X7A
SW 0X00

LDA 0X07 0X9C
JNZ 0X01

#INT_16_DIV__LOOP:
PUSH 0X07
PUSH 0XA5
LDA 0X06 0X0E
JNZ 0X01
LDA 0X07 0XE3
JNZ E

PUSH 0X07
PUSH 0XB3
LDA 0X05 0X8B
JNZ 0X01
LDA 0X07 0XF1
JNZ E


PUSH 0X07
PUSH 0XC1
LDA 0X06 0XC0
JNZ 0X01

PUSH A
PUSH B
LWA B 0X08 0X7A
LWA A 0X08 0X79
PUSH 0X07
PUSH 0XD4
LDA 0X06 0X5C
JNZ 0X01
SWA B 0X08 0X7A
SWA A 0X08 0X79
POP B
POP A

LDA 0X07 0X9C
JNZ 0X01

#INT_16_DIV__DONE:
POP E

LWA B 0X08 0X7A
LWA A 0X08 0X79

POP L
POP H
JNZ 0X01

#INT_16_DIV__EQU:
PUSH A
PUSH B
LWA B 0X08 0X7A
LWA A 0X08 0X79
PUSH 0X08
PUSH 0X04
LDA 0X06 0X5C
JNZ 0X01
SWA B 0X08 0X7A
SWA A 0X08 0X79
POP B
POP A

POP E
POP L
POP H
JNZ 0X01




#INT_16_MOD:
PUSH E

LDA 0X08 0X1D
JNZ 0X01

#INT_16_MOD__LOOP:
PUSH 0X08
PUSH 0X26
LDA 0X06 0X0E
JNZ 0X01
LDA 0X08 0X47
JNZ E

PUSH 0X08
PUSH 0X34
LDA 0X05 0X8B
JNZ 0X01
LDA 0X08 0X4F
JNZ E


PUSH 0X08
PUSH 0X42
LDA 0X06 0XC0
JNZ 0X01

LDA 0X08 0X1D
JNZ 0X01

#INT_16_MOD__DONE:
POP E
POP L
POP H
JNZ 0X01

#INT_16_MOD__EQU:
POP E
LC A 0X00
LC B 0X00
POP L
POP H
JNZ 0X01


#DB DIVCOUNTERH 0X00
#DB DIVCOUNTERL 0X00
